###Contents

1.  MailJet API Wrapper modules  
  1.1. Wrapper API  
  1.2. Wrapper API Implementation
  1.3. Wrapper model generator  
  1.4. Wrapper model
2.  Maven
3.  Building the library  
  3.1. Building a distributable package  
  3.2. Generating eclipse projects  
  3.3. Generation Javadoc
4.  Generating model from metadata


The *MailJet API Wrapper* is implemented in a modular way. Every module can evolve on it's own as long as it preserves source compatability with the others. There are four major functional modules inside the library:

+  Wrapper API 
+  Wrapper API implementation
+  Wrppaer model
+  Wrppaer model generator
  
-------------------------------------------

Chapter 1. MailJet API Wrapper modules
----------------------

####1.1. Wrapper API
This module defines the classes and interfaces that the wrapper clients will use to interact with the wrapper library. They are generic and are used by clients to generate requests to the MailJet API. The module **do not** depend on any other software package.

####1.2. Wrapper API Implementation
This module contains implementation classes of the `Wrapper API` defined interfaces. The current implementation is based on two external libraries for HTTP communication and JSON serialization/deserialization. The module depends upon `Google Gson` and 'Apache HTTPClient` libraries. This module also has a full set of unit tests to verify the correctness of the application.

####1.3. Wrapper model generator
This module is responsible for generation of Java model classes from the MailJet API metadata. This module depends on the `Wrapper API` module as the generated classes depend on the wrapper API. The generation process is described in details in Chapter 4. This module module depends on `JCodeModel` library for source code generation and 'Google Gson' for parsing the API metadata from *JSON* format.

####1.4. Wrapper model
This module contains the domain model generated by the metadata. 

--------------------------------

Chapter 2. Maven
-----------------

The *MailJet API Wrapper* uses `Apache Maven` to manage module dependencies, to automate the build process and assemble the final distributable package provided to *MailJet API Wrapper* users. Maven could be found at [http://maven.apache.org/](http://maven.apache.org/) and should be installed on the build server prior to execution of the build process. To test if the Maven is setup you can execute `mvn` command and assure that the command is recognized. Each Maven project is decribed by a special configuration file `pom.xml`. This file is used by Maven to resolve the dependencies between different application components and establish a build order. Every Maven project contains a `src` and `target` sub-folders containing the sources of the project and the built binaries.

-----------------------------------

Chapter 3.  Building the library
--------------------------

The library uses following file system structure:
```
 mj-java-wrapper
 |
 +-- mailjet-wrapper-api
 |          |
 |          + src
 |          + target
 |    
 +-- mailjet-wrapper-impl
 |    
 +-- mailjet-model-gen
 |    
 +-- mailjet-model
 |    
 +-- mailjet-wrapper-dist
 |    
 +-- mailjet-parent
```

Apart from the Maven projects dedicated to each functional module of the library there are two more projects which simplify the build process. The `mailjet-parent` project doesn't contain any sources and is used to specify  properties common for all the projects, define the version numbers for different modules  at central place and build all the other projects with single command:

```
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>com.mailjet</groupId>
	<artifactId>mailjet-parent</artifactId>
	<version>1.0-SNAPSHOT</version>
	<packaging>pom</packaging>
	<modules>
		<module>../mailjet-wrapper-dist</module>
		<module>../mailjet-wrapper-api</module>
		<module>../mailjet-wrapper-impl</module>
		<module>../mailjet-model-gen</module>
		<module>../mailjet-model</module>
	</modules>
	...	
	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<gson.version>2.2.4</gson.version>
		<httpclient.version>4.3</httpclient.version>
		<mailjet.wrapper.api.version>1.0-SNAPSHOT</mailjet.wrapper.api.version>
		<mailjet.wrapper.impl.version>1.0-SNAPSHOT</mailjet.wrapper.impl.version>
		<mailjet.model.version>1.0-SNAPSHOT</mailjet.model.version>
		<mailjet.model.gen.version>1.0-SNAPSHOT</mailjet.model.gen.version>
	</properties>
	
	<organization>
		<name>MailJet</name>
		<url>http://www.mailjet.com</url>
	</organization>
</project>
```

###3.1. Building a distributable package
Executing the command `mvn clean package` in the folder containing the `pom.xml` file will cause Maven to compile sources in all modules, execute of available unit tests, generate binaries for each module, assemble module binaries in a single JAR file and generate of an archive containing the assesmbled JAR and external dependencies. As part of the build process, Java sources will be generated from API metadata, compiled and included in assembly JAR. The second project that has no Java sources inside and is used to assemble the distributable package is `mailjet-wrapper-dist`. Following listing summerize the role of each project in the build process and it's output:

####3.1.1. Build of `mailjet-wrapper-api` project
The build process compiles all the sources available in `src/main/java` folder and creates a single jar file that can be found in `target`.
####3.1.2. Build of `mailjet-wrapper-impl` project
The build process compiles all the sources available in `src/main/java` folder and creates a single jar file that can be found in `target`. Executes all tests located in `src/test/java` folder. If any of the tests failed the build process halts.
####3.1.3. Build of `mailjet-model-gen` project
The build process compiles all the sources available in `src/main/java` folder and creates a single jar file that can be found in `target`.
####3.1.4. Build of `mailjet-model` project
The build process generates model sources from metatdata inside `target/generated-sources/java` using the binaries of `mailjet-model-gen` and compiles in combination with the sources available in `src/main/java`. The result is a single jar file that can be found in `target`.
####3.1.5. Build of `mailjet-wrapper-dist` project
The build process assembles binaries from projects `mailjet-wrapper-api`, `mailjet-wrapper-impl` and `mailjet-model` into a single JAR file. An archive containing the assembly JAR file along with external library dependencies is generated and written in `target/distribution`.

###3.2. Generating eclipse projects 
Maven support generation of *eclipse* projects for each of the projects containing application sources. This goal can be achieved with the command `mvn eclipse:eclipse` inside `mailjet-parent` project. As result a `.classpath` and `.project` files are generated and the projects could be included in a workspace so that sources could be altered.
###3.3. Generation Javadoc
Javadoc for all application classes could be genrated by running the command `mvn javadoc:aggregate` in `mailjet-parent` project. The output could be found in `target/site/apidocs` folder of the project.

---------------------------------------------

Chapter 4. Generating model from metadata
-------------------------------------
The library could automatically generate Java classes from API metata. The generation process is automated and integrated in the build routine of the library. It uses three configuration files located inside `src/main/generate`.
####File `metadata.json`
This file contains the metadata that is used as input of the generation process. The contents are exactly the same as the API returns them without any processing.
```
{
   "Count":49,
   "Data":[
      {
         "Description":"Mailjet API Keys",
         "Filters":[
            {
               "DataType":"AnsiString",
               "DefaultValue":"",
               "Description":"Only retrieve apikey resources for which APIKey equals the specified value.",
               "IsRequired":false,
               "Name":"APIKey"
            },
            ...
```
####File `dictionary.txt`
This file contains words that are used inside resource names. The file is used to generate Java class names that follow Java naming rules and conventions. For example the resource `apikeyaccess` is rendered as `ApiKeyAccess` in Java sources if the dictonary contains words `api`, `key`, `access`. Sample contents:
```
api
key
access
token
totals
batch
job
bounce
statistics
campaign
click
contact
list
...
```
####File `type.properties`
This file is used by the library to map types used inside the metadata to Java types. The file could define mapping rules in following cases:

+ Mapping metadata types to Java built-in types
```
Boolean=java.lang.Boolean
Integer=java.lang.Integer
LongInt=java.lang.Integer
SmallInt=java.lang.Short
Int64=java.lang.Long
...
TBillingEmail=java.lang.String
TEmail=java.lang.String
TSenderEmail=java.lang.String
TStrings=java.util.List<java.lang.String>
...
```
+ Mapping metadata types to custom Java types
```
TProperty=com.mailjet.api.model.v3.customtypes.Property
TFilter=com.mailjet.api.model.v3.customtypes.Filter
TResourceOps=java.lang.String
TSpamAssassinRuleList=com.mailjet.api.model.v3.customtypes.SpamAssassinRuleList
```
+ Specifying Java type for specific property
```
manycontacts.Recipients=com.mailjet.api.model.v3.customtypes.ManyContactsListRecipientList
manycontacts.Errors=java.lang.Object
```
